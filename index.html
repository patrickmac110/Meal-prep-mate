<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>MealPrepMate</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="/Meal-prep-mate/manifest.json" />

  <!-- iOS PWA Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#10b981">
  <meta name="application-name" content="MealPrepMate">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="MealPrepMate" />
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1830/1830839.png" />

  <!-- Critical inline styles for loading screen - NO external dependencies -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #f8fafc;
    }

    #loading-screen {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
      z-index: 9999;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e2e8f0;
      border-top-color: #10b981;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    #root {
      min-height: 100vh;
      min-height: 100dvh;
      background: #fff;
    }
  </style>
</head>

<body>
  <!-- Loading indicator - pure HTML/CSS, no JS needed -->
  <div id="loading-screen">
    <div style="text-align:center;">
      <div class="spinner"></div>
      <p style="color:#64748b;">Loading MealPrepMate...</p>
      <p style="color:#94a3b8;font-size:12px;margin-top:8px;">v__APP_VERSION__</p>
    </div>
  </div>

  <!-- App container -->
  <div id="root"></div>

  <!-- Load Tailwind AFTER the page shows (non-blocking) -->
  <script>
    // Load Tailwind asynchronously - won't block page render
    var tw = document.createElement('script');
    tw.src = 'https://cdn.tailwindcss.com';
    tw.onload = function () {
      // Configure Tailwind after it loads
      if (window.tailwind) {
        tailwind.config = {
          theme: {
            extend: {
              animation: {
                'fade-in': 'fadeIn 0.3s ease-out',
                'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
              },
              keyframes: {
                fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                slideUp: { '0%': { transform: 'translateY(100%)' }, '100%': { transform: 'translateY(0)' } },
                pulseSoft: { '0%, 100%': { opacity: '1' }, '50%': { opacity: '0.7' } },
              },
            },
          },
        };
      }
      console.log('Tailwind loaded');
    };
    tw.onerror = function () {
      console.error('Tailwind failed to load');
    };
    document.head.appendChild(tw);

    // Clear ALL caches and unregister ALL service workers
    (function () {
      if ('caches' in window) {
        caches.keys().then(function (names) {
          names.forEach(function (name) { caches.delete(name); });
        });
      }
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function (regs) {
          regs.forEach(function (reg) { reg.unregister(); });
        });
      }
    })();

    // Failsafe - show error after 15 seconds if app doesn't load
    setTimeout(function () {
      var root = document.getElementById('root');
      var loader = document.getElementById('loading-screen');
      if (root && root.children.length === 0 && loader) {
        loader.innerHTML = '<div style="text-align:center;padding:40px;">' +
          '<h2 style="color:#ef4444;margin-bottom:16px;">⚠️ App Failed to Load</h2>' +
          '<p style="color:#64748b;margin-bottom:24px;">Please try clearing your browser cache<br/>or delete and re-add the app.</p>' +
          '<button onclick="location.reload(true)" style="background:#10b981;color:white;padding:12px 24px;border:none;border-radius:12px;font-weight:bold;cursor:pointer;">Refresh Now</button>' +
          '<p style="color:#94a3b8;font-size:11px;margin-top:16px;">iOS Safari: Settings → Safari → Clear History</p>' +
          '</div>';
      }
    }, 15000);
  </script>

  <!-- Main app -->
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>